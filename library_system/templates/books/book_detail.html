{% extends 'base.html' %} {% load static %} {% block title %}{{ book.title }}
{%endblock %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'css/catalog.css' %}" />
{% endblock %} 
{% block content %}
<div class="container">
  <div class="book-detail">
    <div class="book-header">
      <h1>{{ book.title }}</h1>
      {% if book.is_available %}
      <span class="status available">
        <i class="fas fa-check-circle"></i> Доступна
      </span>
      {% else %}
      <span class="status unavailable">
        <i class="fas fa-times-circle"></i> Нет в наличии
      </span>
      {% endif %}
    </div>

    <div class="book-info">
      <p><strong>Автор:</strong> {{ book.author.name }}</p>
      <p><strong>Жанр:</strong> {{ book.genre.name }}</p>
      <p>
        <strong>Доступно экземпляров:</strong> {{ book.available_copies }} из {{book.total_copies }}
      </p>

      {% if book.publication_year %}
      <p><strong>Год издания:</strong> {{ book.publication_year }}</p>
      {% endif %} 
      {% if book.publisher %}
      <p><strong>Издательство:</strong> {{ book.publisher }}</p>
      {% endif %} 
      {% if book.isbn %}
      <p><strong>ISBN:</strong> {{ book.isbn }}</p>
      {% endif %} 
      {% if user.is_authenticated and not user.is_librarian and not user.is_admin %} 
      {% with user_requests=book.bookrequest_set.all|length %}
      {% if user_requests > 0 %}
      <div class="request-status">
        <p>
          <strong>Статус заявки:</strong>
          {% for request in book.bookrequest_set.all %} {% if request.user ==
          user %} 
          {% if request.status == 'pending' %}
          <span class="status pending">Ожидает одобрения</span>
          {% elif request.status == 'approved' %}
          <span class="status approved">Одобрена</span>
          {% elif request.status == 'rejected' %}
          <span class="status rejected">Отклонена</span>
              {% endif %}  
            {% endfor %}
          </p>
        </div>
      {% endif %} 
    {% endwith %} 
  {% endif %} 
</div>

    {% if book.description %}
    <div class="book-description">
      <h3>Описание</h3>
      <p>{{ book.description }}</p>
    </div>
    {% endif %}

    <div class="book-actions">
      <a href="{% url 'books:book_list' %}" class="btn btn-secondary"
        >← Назад к каталогу</a
      >

      {% if user.is_authenticated %} {% if user.is_librarian or user.is_admin %}
      <a
        href="{% url 'borrowings:borrow_form' %}?book={{ book.id }}"
        class="btn btn-primary"
      >
        <i class="fas fa-book"></i> Выдать книгу
      </a>
      <a href="{% url 'books:edit_book' book.id %}" class="btn btn-primary"
        >Редактировать</a
      >
      {% else %} {% if user_has_book %}
      <span class="btn btn-success" style="cursor: not-allowed; opacity: 0.7">
        <i class="fas fa-check"></i> У вас на руках
      </span>
      {% elif book.is_available %}
      {% else %}
      <span class="btn btn-disabled" style="cursor: not-allowed; opacity: 0.7">
        <i class="fas fa-clock"></i> Недоступно
      </span>
      {% endif %} 
    {% endif %} 
  {% else %}
      <a
        href="{% url 'login' %}?next={{ request.path }}"
        class="btn btn-primary"
      >
        <i class="fas fa-sign-in-alt"></i> Войти
      </a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}