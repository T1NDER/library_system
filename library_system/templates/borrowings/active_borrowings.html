{% extends 'base.html' %}
{% load static %}

{% block title %}–ê–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/borrowings.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">üìö –ê–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥</h1>

    {% if user.is_librarian or user.is_admin %}
    <div class="actions">
        <a href="{% url 'borrowings:borrow_form' %}" class="btn btn-primary">
            <i class="fas fa-book"></i> –í—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É
        </a>
        <a href="{% url 'books:book_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> –ö –∫–∞—Ç–∞–ª–æ–≥—É –∫–Ω–∏–≥
        </a>
    </div>
    {% endif %}

    {% if active_borrowings %}
        <div class="table-wrapper">
            <table class="data-table">
                <thead>
                    <tr>
                        <th width="20%">–ö–Ω–∏–≥–∞</th>
                        <th width="15%">–ê–≤—Ç–æ—Ä</th>
                        <th width="15%">–ß–∏—Ç–∞—Ç–µ–ª—å</th>
                        <th width="12%">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                        <th width="12%">–°—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞</th>
                        <th width="16%">–°—Ç–∞—Ç—É—Å</th>
                        {% if user.is_librarian or user.is_admin %}
                        <th width="10%">–î–µ–π—Å—Ç–≤–∏—è</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for borrowing in active_borrowings %}
                    <tr>
                        <td>
                            <strong>{{ borrowing.book.title }}</strong><br>
                            <small class="text-muted">ISBN: {{ borrowing.book.isbn|default:"-" }}</small>
                        </td>
                        <td>{{ borrowing.book.author.name }}</td>
                        <td>
                            <strong>{{ borrowing.user.get_full_name|default:borrowing.user.username }}</strong><br>
                            <small class="text-muted">{{ borrowing.user.username }}</small>
                        </td>
                        <td class="text-center">{{ borrowing.borrow_date|date:"d.m.Y" }}</td>
                        <td class="text-center">{{ borrowing.due_date|date:"d.m.Y" }}</td>
                        <td class="text-center">
                            {% if borrowing.is_overdue %}
                                <span class="badge badge-danger">
                                    ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ<br>
                                    <small>{{ borrowing.days_overdue }} –¥–Ω.</small>
                                </span>
                            {% else %}
                                <span class="badge badge-success">
                                    ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ<br>
                                    <small>{{ borrowing.days_until_due }} –¥–Ω.</small>
                                </span>
                            {% endif %}
                        </td>
                        {% if user.is_librarian or user.is_admin %}
                        <td class="text-center">
                            <a href="{% url 'borrowings:return_book' borrowing.id %}" class="btn btn-sm btn-return">
                                –í–µ—Ä–Ω—É—Ç—å
                            </a>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h3>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á</h3>
            <p>–í—Å–µ –∫–Ω–∏–≥–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ</p>
            {% if user.is_librarian or user.is_admin %}
            <a href="{% url 'borrowings:borrow_form' %}" class="btn btn-primary">
                <i class="fas fa-book"></i> –í—ã–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É
            </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}