{% extends 'base.html' %}
{% load static %}

{% block title %}–ê–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/borrowings.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">üìö –ê–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥</h1>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¢–û–õ–¨–ö–û –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–µ–π -->
    {% if user.is_librarian or user.is_admin %}
    <div class="actions">
        <a href="{% url 'borrowings:borrow_form' %}" class="btn btn-primary">
            <i class="fas fa-book"></i> –í—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É
        </a>
        <a href="{% url 'books:book_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> –ö –∫–∞—Ç–∞–ª–æ–≥—É –∫–Ω–∏–≥
        </a>
    </div>
    {% endif %}

    {% if active_borrowings %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>–ö–Ω–∏–≥–∞</th>
                        <th>–ê–≤—Ç–æ—Ä</th>
                        <th>–ß–∏—Ç–∞—Ç–µ–ª—å</th>
                        <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                        <th>–°—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        {% if user.is_librarian or user.is_admin %}
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for borrowing in active_borrowings %}
                    <tr>
                        <td>
                            <div class="book-title">{{ borrowing.book.title }}</div>
                            <div class="book-author">ISBN: {{ borrowing.book.isbn|default:"-" }}</div>
                        </td>
                        <td>
                            <div class="book-author">{{ borrowing.book.author.name }}</div>
                        </td>
                        <td>
                            <div class="reader-name">{{ borrowing.user.get_full_name|default:borrowing.user.username }}</div>
                            <div class="book-author">–õ–æ–≥–∏–Ω: {{ borrowing.user.username }}</div>
                        </td>
                        <td class="date-cell">{{ borrowing.borrow_date|date:"d.m.Y" }}</td>
                        <td class="date-cell">{{ borrowing.due_date|date:"d.m.Y" }}</td>
                        <td>
                            {% if borrowing.is_overdue %}
                                <span class="status-badge status-overdue">
                                    ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ {{ borrowing.days_overdue }} –¥–Ω.
                                </span>
                            {% else %}
                                <span class="status-badge status-active">
                                    ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ (–æ—Å—Ç–∞–ª–æ—Å—å {{ borrowing.days_until_due }} –¥–Ω.)
                                </span>
                            {% endif %}
                        </td>
                        {% if user.is_librarian or user.is_admin %}
                        <td>
                            <a href="{% url 'borrowings:return_book' borrowing.id %}" class="btn-action btn-return">
                                <i class="fas fa-undo-alt"></i> –í–µ—Ä–Ω—É—Ç—å
                            </a>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h3>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á</h3>
            <p>–í—Å–µ –∫–Ω–∏–≥–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ</p>
            {% if user.is_librarian or user.is_admin %}
            <a href="{% url 'borrowings:borrow_form' %}" class="btn btn-primary">
                <i class="fas fa-book"></i> –í—ã–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É
            </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}